<!DOCTYPE html>
<html>
<head>
    <title>RISC-V VM Simulator</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #debug { white-space: pre; font-family: monospace; background: #f0f0f0; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <h2>RISC-V Virtual Memory Simulator</h2>
    
    <div>
        <input type="text" id="va" placeholder="Enter VA (e.g., 0x40000000)">
        <button id="translate-btn">Translate</button>
    </div>
    
    <div id="debug"></div>

    <script src="sim.js"></script>
    <script>
        Module.onRuntimeInitialized = () => {
            Module.ccall('demo_setup', null, [], []);
            document.getElementById('translate-btn').disabled = false;
        };

        document.getElementById('translate-btn').addEventListener('click', () => {
            const vaInput = document.getElementById('va').value;
            const va = parseInt(vaInput, 16);
            
            if (isNaN(va)) {
                alert("Invalid hexadecimal address");
                return;
            }

            const pa = Module.ccall('sv32_translate', 'number', ['number'], [va]);
            const log_ptr = Module.ccall('get_log_buffer', 'number', [], []);
            const logs = Module.UTF8ToString(log_ptr);            
            document.getElementById('debug').textContent = logs + 
                `\nResult: ${pa === 0xFFFFFFFFFFFFFFFF ? 'Page Fault' : 'PA: 0x' + pa.toString(16).toUpperCase()}`;
        });
    </script>
</body>
</html>
